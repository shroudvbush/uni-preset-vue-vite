import{l as e,s as t,g as o,_ as a,c as s,w as n,a as l,b as i,n as c,d as r,h as d,i as u,o as p,e as h,f as m,j as f,k as g,m as w,p as y,I as _,q as k,t as b}from"./js/index.DbooXYOL.js";import{r as C}from"./request.DRycooUd.js";const T=t=>new Promise(((o,a)=>{e({provider:t,success:e=>{o(e.code)},fail:e=>{a(e)}})})),v=e=>new Promise(((t,o)=>{uni.getUserInfo({provider:e,success:e=>{t(e.userInfo)},fail:e=>{o(e)}})})),x="weixin",F="qq",P="alipay",Q="apple",S=e=>{const t=o().platform,a=o().system;switch(e){case x:case F:case P:return!0;case Q:return"ios"===t&&a.includes("iOS");default:return!1}},V=async()=>{try{if(!S(x))throw new Error("当前平台不支持微信登录");const t=await T(x),o=await v(x);return await(e={code:t,userInfo:o},C({url:"/auth/login/wechat",method:"POST",data:e}))}catch(t){throw console.error("微信登录失败:",t),t}var e},I=async()=>{try{if(!S(F))throw new Error("当前平台不支持QQ登录");const t=await T(F),o=await v(F);return await(e={code:t,userInfo:o},C({url:"/auth/login/qq",method:"POST",data:e}))}catch(t){throw console.error("QQ登录失败:",t),t}var e},L=async()=>{try{if(!S(Q))throw new Error("当前平台不支持苹果登录");const t=await T(Q),o=await v(Q);return await(e={code:t,userInfo:o},C({url:"/auth/login/apple",method:"POST",data:e}))}catch(t){throw console.error("苹果登录失败:",t),t}var e},q=(e,o)=>{try{t("userInfo",e),t("token",o),t("loginTime",Date.now())}catch(a){console.error("保存登录状态失败:",a)}};const A=a({data:()=>({loginType:"phone",phoneForm:{phone:"",code:""},accountForm:{username:"",password:""},showPassword:!1,countdown:0,isWechatSupported:!1,isQQSupported:!1,isAlipaySupported:!1,isAppleSupported:!1}),computed:{isFormValid(){return"phone"===this.loginType?11===this.phoneForm.phone.length&&6===this.phoneForm.code.length:this.accountForm.username&&this.accountForm.password.length>=6}},onLoad(){this.checkPlatformSupport()},methods:{checkPlatformSupport(){this.isWechatSupported=S("weixin"),this.isQQSupported=S("qq"),this.isAlipaySupported=S("alipay"),this.isAppleSupported=S("apple")},switchLoginType(e){this.loginType=e},togglePassword(){this.showPassword=!this.showPassword},async sendCode(){if(this.phoneForm.phone&&11===this.phoneForm.phone.length)try{r({title:"发送中..."}),setTimeout((()=>{d(),l({title:"验证码已发送",icon:"success"}),this.countdown=60;const e=setInterval((()=>{this.countdown--,this.countdown<=0&&clearInterval(e)}),1e3)}),1e3)}catch(e){d(),l({title:"发送失败",icon:"none"})}else l({title:"请输入正确的手机号",icon:"none"})},async handleLogin(){var e;if(this.isFormValid)try{let t;r({title:"登录中..."}),t="phone"===this.loginType?await(e=this.phoneForm,C({url:"/auth/login/phone",method:"POST",data:e})):await(e=>C({url:"/auth/login",method:"POST",data:e}))(this.accountForm),0===t.code?(q(t.data.userInfo,t.data.token),l({title:"登录成功",icon:"success"}),setTimeout((()=>{i({url:"/pages/index/index"})}),1500)):l({title:t.message||"登录失败",icon:"none"})}catch(t){console.error("登录失败:",t),l({title:"登录失败",icon:"none"})}finally{d()}else l({title:"请完善登录信息",icon:"none"})},async handleWechatLogin(){console.log("点击微信登录");try{r({title:"登录中..."});const e=await V();0===e.code&&(q(e.data.userInfo,e.data.token),l({title:"登录成功",icon:"success"}),setTimeout((()=>{i({url:"/pages/index/index"})}),1500))}catch(e){l({title:"微信登录失败",icon:"none"})}finally{d()}},async handleQQLogin(){console.log("点击QQ登录");try{r({title:"登录中..."});const e=await I();0===e.code&&(q(e.data.userInfo,e.data.token),l({title:"登录成功",icon:"success"}),setTimeout((()=>{i({url:"/pages/index/index"})}),1500))}catch(e){l({title:"QQ登录失败",icon:"none"})}finally{d()}},async handleAppleLogin(){try{r({title:"登录中..."});const e=await L();0===e.code&&(q(e.data.userInfo,e.data.token),l({title:"登录成功",icon:"success"}),setTimeout((()=>{i({url:"/pages/index/index"})}),1500))}catch(e){l({title:"苹果登录失败",icon:"none"})}finally{d()}},forgotPassword(){c({url:"/pages/login/forgot-password"})},goToRegister(){c({url:"/pages/login/register"})},viewAgreement(){c({url:"/pages/common/agreement"})},viewPrivacy(){c({url:"/pages/common/privacy"})},guestLogin(){const e={id:"guest",username:"游客",role:"guest"},t="guest-token";q(e,t),l({title:"欢迎体验",icon:"success"}),setTimeout((()=>{i({url:"/pages/index/index"})}),800)}}},[["render",function(e,t,o,a,l,i){const c=m,r=f,d=u,C=_,T=k;return p(),s(d,{class:"login-container"},{default:n((()=>[h(d,{class:"logo-section"},{default:n((()=>[h(c,{src:"/01/static/logo.png",class:"logo",mode:"aspectFit"}),h(r,{class:"app-name"},{default:n((()=>[g("医影随护")])),_:1}),h(r,{class:"app-slogan"},{default:n((()=>[g("智能健康管理，贴心医疗陪伴")])),_:1})])),_:1}),h(d,{class:"login-form"},{default:n((()=>[h(d,{class:"login-tabs"},{default:n((()=>[h(d,{class:y(["tab-item",{active:"phone"===l.loginType}]),onClick:t[0]||(t[0]=e=>i.switchLoginType("phone"))},{default:n((()=>[h(r,null,{default:n((()=>[g("手机号登录")])),_:1})])),_:1},8,["class"]),h(d,{class:y(["tab-item",{active:"account"===l.loginType}]),onClick:t[1]||(t[1]=e=>i.switchLoginType("account"))},{default:n((()=>[h(r,null,{default:n((()=>[g("账号密码登录")])),_:1})])),_:1},8,["class"])])),_:1}),"phone"===l.loginType?(p(),s(d,{key:0,class:"phone-login"},{default:n((()=>[h(d,{class:"form-item"},{default:n((()=>[h(d,{class:"input-wrapper"},{default:n((()=>[h(r,{class:"input-icon"},{default:n((()=>[g("📱")])),_:1}),h(C,{class:"form-input",modelValue:l.phoneForm.phone,"onUpdate:modelValue":t[2]||(t[2]=e=>l.phoneForm.phone=e),placeholder:"请输入手机号",type:"number",maxlength:"11"},null,8,["modelValue"])])),_:1})])),_:1}),h(d,{class:"form-item"},{default:n((()=>[h(d,{class:"input-wrapper"},{default:n((()=>[h(r,{class:"input-icon"},{default:n((()=>[g("🔐")])),_:1}),h(C,{class:"form-input",modelValue:l.phoneForm.code,"onUpdate:modelValue":t[3]||(t[3]=e=>l.phoneForm.code=e),placeholder:"请输入验证码",type:"number",maxlength:"6"},null,8,["modelValue"]),h(T,{class:"code-btn",disabled:l.countdown>0,onClick:i.sendCode},{default:n((()=>[g(b(l.countdown>0?`${l.countdown}s`:"获取验证码"),1)])),_:1},8,["disabled","onClick"])])),_:1})])),_:1})])),_:1})):w("",!0),"account"===l.loginType?(p(),s(d,{key:1,class:"account-login"},{default:n((()=>[h(d,{class:"form-item"},{default:n((()=>[h(d,{class:"input-wrapper"},{default:n((()=>[h(r,{class:"input-icon"},{default:n((()=>[g("👤")])),_:1}),h(C,{class:"form-input",modelValue:l.accountForm.username,"onUpdate:modelValue":t[4]||(t[4]=e=>l.accountForm.username=e),placeholder:"请输入用户名/手机号"},null,8,["modelValue"])])),_:1})])),_:1}),h(d,{class:"form-item"},{default:n((()=>[h(d,{class:"input-wrapper"},{default:n((()=>[h(r,{class:"input-icon"},{default:n((()=>[g("🔒")])),_:1}),h(C,{class:"form-input",modelValue:l.accountForm.password,"onUpdate:modelValue":t[5]||(t[5]=e=>l.accountForm.password=e),placeholder:"请输入密码",type:l.showPassword?"text":"password"},null,8,["modelValue","type"]),h(r,{class:"password-toggle",onClick:i.togglePassword},{default:n((()=>[g(b(l.showPassword?"👁️":"🙈"),1)])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})):w("",!0),h(T,{class:"login-btn",disabled:!i.isFormValid,onClick:i.handleLogin},{default:n((()=>[h(r,null,{default:n((()=>[g("登录")])),_:1})])),_:1},8,["disabled","onClick"]),h(T,{class:"guest-btn",onClick:i.guestLogin,type:"button"},{default:n((()=>[h(r,null,{default:n((()=>[g("免注册体验")])),_:1})])),_:1},8,["onClick"]),h(d,{class:"other-options"},{default:n((()=>[h(d,{class:"forgot-password",onClick:i.forgotPassword},{default:n((()=>[g("忘记密码？")])),_:1},8,["onClick"]),h(d,{class:"register-link",onClick:i.goToRegister},{default:n((()=>[g("注册账号")])),_:1},8,["onClick"])])),_:1})])),_:1}),h(d,{class:"third-party-login"},{default:n((()=>[h(d,{class:"divider"},{default:n((()=>[h(d,{class:"divider-line"}),h(r,{class:"divider-text"},{default:n((()=>[g("其他登录方式")])),_:1}),h(d,{class:"divider-line"})])),_:1}),h(d,{class:"third-party-buttons"},{default:n((()=>[l.isWechatSupported?(p(),s(d,{key:0,class:"third-party-btn wechat-btn",onClick:i.handleWechatLogin},{default:n((()=>[h(d,{class:"btn-icon"},{default:n((()=>[g("💬")])),_:1}),h(d,{class:"btn-text"},{default:n((()=>[g("微信登录")])),_:1})])),_:1},8,["onClick"])):w("",!0),l.isQQSupported?(p(),s(d,{key:1,class:"third-party-btn qq-btn",onClick:i.handleQQLogin},{default:n((()=>[h(d,{class:"btn-icon"},{default:n((()=>[g("🐧")])),_:1}),h(d,{class:"btn-text"},{default:n((()=>[g("QQ登录")])),_:1})])),_:1},8,["onClick"])):w("",!0),l.isAppleSupported?(p(),s(d,{key:2,class:"third-party-btn apple-btn",onClick:i.handleAppleLogin},{default:n((()=>[h(d,{class:"btn-icon"},{default:n((()=>[g("🍎")])),_:1}),h(d,{class:"btn-text"},{default:n((()=>[g("苹果登录")])),_:1})])),_:1},8,["onClick"])):w("",!0)])),_:1})])),_:1}),h(d,{class:"agreement"},{default:n((()=>[h(r,{class:"agreement-text"},{default:n((()=>[g(" 登录即表示同意 "),h(r,{class:"agreement-link",onClick:i.viewAgreement},{default:n((()=>[g("《用户协议》")])),_:1},8,["onClick"]),g(" 和 "),h(r,{class:"agreement-link",onClick:i.viewPrivacy},{default:n((()=>[g("《隐私政策》")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-e219a0b7"]]);export{A as default};
