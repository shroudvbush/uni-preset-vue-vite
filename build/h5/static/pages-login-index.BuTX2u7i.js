import{l as e,s as t,g as o,_ as a,c as s,w as n,a as l,b as i,n as c,d as r,h as d,i as u,o as p,e as h,f as m,j as f,k as g,m as w,p as y,I as _,q as k,t as b}from"./js/index.DbooXYOL.js";import{r as C}from"./request.DRycooUd.js";const T=t=>new Promise(((o,a)=>{e({provider:t,success:e=>{o(e.code)},fail:e=>{a(e)}})})),v=e=>new Promise(((t,o)=>{uni.getUserInfo({provider:e,success:e=>{t(e.userInfo)},fail:e=>{o(e)}})})),x="weixin",F="qq",P="alipay",Q="apple",S=e=>{const t=o().platform,a=o().system;switch(e){case x:case F:case P:return!0;case Q:return"ios"===t&&a.includes("iOS");default:return!1}},V=async()=>{try{if(!S(x))throw new Error("å½“å‰å¹³å°ä¸æ”¯æŒå¾®ä¿¡ç™»å½•");const t=await T(x),o=await v(x);return await(e={code:t,userInfo:o},C({url:"/auth/login/wechat",method:"POST",data:e}))}catch(t){throw console.error("å¾®ä¿¡ç™»å½•å¤±è´¥:",t),t}var e},I=async()=>{try{if(!S(F))throw new Error("å½“å‰å¹³å°ä¸æ”¯æŒQQç™»å½•");const t=await T(F),o=await v(F);return await(e={code:t,userInfo:o},C({url:"/auth/login/qq",method:"POST",data:e}))}catch(t){throw console.error("QQç™»å½•å¤±è´¥:",t),t}var e},L=async()=>{try{if(!S(Q))throw new Error("å½“å‰å¹³å°ä¸æ”¯æŒè‹¹æœç™»å½•");const t=await T(Q),o=await v(Q);return await(e={code:t,userInfo:o},C({url:"/auth/login/apple",method:"POST",data:e}))}catch(t){throw console.error("è‹¹æœç™»å½•å¤±è´¥:",t),t}var e},q=(e,o)=>{try{t("userInfo",e),t("token",o),t("loginTime",Date.now())}catch(a){console.error("ä¿å­˜ç™»å½•çŠ¶æ€å¤±è´¥:",a)}};const A=a({data:()=>({loginType:"phone",phoneForm:{phone:"",code:""},accountForm:{username:"",password:""},showPassword:!1,countdown:0,isWechatSupported:!1,isQQSupported:!1,isAlipaySupported:!1,isAppleSupported:!1}),computed:{isFormValid(){return"phone"===this.loginType?11===this.phoneForm.phone.length&&6===this.phoneForm.code.length:this.accountForm.username&&this.accountForm.password.length>=6}},onLoad(){this.checkPlatformSupport()},methods:{checkPlatformSupport(){this.isWechatSupported=S("weixin"),this.isQQSupported=S("qq"),this.isAlipaySupported=S("alipay"),this.isAppleSupported=S("apple")},switchLoginType(e){this.loginType=e},togglePassword(){this.showPassword=!this.showPassword},async sendCode(){if(this.phoneForm.phone&&11===this.phoneForm.phone.length)try{r({title:"å‘é€ä¸­..."}),setTimeout((()=>{d(),l({title:"éªŒè¯ç å·²å‘é€",icon:"success"}),this.countdown=60;const e=setInterval((()=>{this.countdown--,this.countdown<=0&&clearInterval(e)}),1e3)}),1e3)}catch(e){d(),l({title:"å‘é€å¤±è´¥",icon:"none"})}else l({title:"è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·",icon:"none"})},async handleLogin(){var e;if(this.isFormValid)try{let t;r({title:"ç™»å½•ä¸­..."}),t="phone"===this.loginType?await(e=this.phoneForm,C({url:"/auth/login/phone",method:"POST",data:e})):await(e=>C({url:"/auth/login",method:"POST",data:e}))(this.accountForm),0===t.code?(q(t.data.userInfo,t.data.token),l({title:"ç™»å½•æˆåŠŸ",icon:"success"}),setTimeout((()=>{i({url:"/pages/index/index"})}),1500)):l({title:t.message||"ç™»å½•å¤±è´¥",icon:"none"})}catch(t){console.error("ç™»å½•å¤±è´¥:",t),l({title:"ç™»å½•å¤±è´¥",icon:"none"})}finally{d()}else l({title:"è¯·å®Œå–„ç™»å½•ä¿¡æ¯",icon:"none"})},async handleWechatLogin(){console.log("ç‚¹å‡»å¾®ä¿¡ç™»å½•");try{r({title:"ç™»å½•ä¸­..."});const e=await V();0===e.code&&(q(e.data.userInfo,e.data.token),l({title:"ç™»å½•æˆåŠŸ",icon:"success"}),setTimeout((()=>{i({url:"/pages/index/index"})}),1500))}catch(e){l({title:"å¾®ä¿¡ç™»å½•å¤±è´¥",icon:"none"})}finally{d()}},async handleQQLogin(){console.log("ç‚¹å‡»QQç™»å½•");try{r({title:"ç™»å½•ä¸­..."});const e=await I();0===e.code&&(q(e.data.userInfo,e.data.token),l({title:"ç™»å½•æˆåŠŸ",icon:"success"}),setTimeout((()=>{i({url:"/pages/index/index"})}),1500))}catch(e){l({title:"QQç™»å½•å¤±è´¥",icon:"none"})}finally{d()}},async handleAppleLogin(){try{r({title:"ç™»å½•ä¸­..."});const e=await L();0===e.code&&(q(e.data.userInfo,e.data.token),l({title:"ç™»å½•æˆåŠŸ",icon:"success"}),setTimeout((()=>{i({url:"/pages/index/index"})}),1500))}catch(e){l({title:"è‹¹æœç™»å½•å¤±è´¥",icon:"none"})}finally{d()}},forgotPassword(){c({url:"/pages/login/forgot-password"})},goToRegister(){c({url:"/pages/login/register"})},viewAgreement(){c({url:"/pages/common/agreement"})},viewPrivacy(){c({url:"/pages/common/privacy"})},guestLogin(){const e={id:"guest",username:"æ¸¸å®¢",role:"guest"},t="guest-token";q(e,t),l({title:"æ¬¢è¿ä½“éªŒ",icon:"success"}),setTimeout((()=>{i({url:"/pages/index/index"})}),800)}}},[["render",function(e,t,o,a,l,i){const c=m,r=f,d=u,C=_,T=k;return p(),s(d,{class:"login-container"},{default:n((()=>[h(d,{class:"logo-section"},{default:n((()=>[h(c,{src:"/01/static/logo.png",class:"logo",mode:"aspectFit"}),h(r,{class:"app-name"},{default:n((()=>[g("åŒ»å½±éšæŠ¤")])),_:1}),h(r,{class:"app-slogan"},{default:n((()=>[g("æ™ºèƒ½å¥åº·ç®¡ç†ï¼Œè´´å¿ƒåŒ»ç–—é™ªä¼´")])),_:1})])),_:1}),h(d,{class:"login-form"},{default:n((()=>[h(d,{class:"login-tabs"},{default:n((()=>[h(d,{class:y(["tab-item",{active:"phone"===l.loginType}]),onClick:t[0]||(t[0]=e=>i.switchLoginType("phone"))},{default:n((()=>[h(r,null,{default:n((()=>[g("æ‰‹æœºå·ç™»å½•")])),_:1})])),_:1},8,["class"]),h(d,{class:y(["tab-item",{active:"account"===l.loginType}]),onClick:t[1]||(t[1]=e=>i.switchLoginType("account"))},{default:n((()=>[h(r,null,{default:n((()=>[g("è´¦å·å¯†ç ç™»å½•")])),_:1})])),_:1},8,["class"])])),_:1}),"phone"===l.loginType?(p(),s(d,{key:0,class:"phone-login"},{default:n((()=>[h(d,{class:"form-item"},{default:n((()=>[h(d,{class:"input-wrapper"},{default:n((()=>[h(r,{class:"input-icon"},{default:n((()=>[g("ğŸ“±")])),_:1}),h(C,{class:"form-input",modelValue:l.phoneForm.phone,"onUpdate:modelValue":t[2]||(t[2]=e=>l.phoneForm.phone=e),placeholder:"è¯·è¾“å…¥æ‰‹æœºå·",type:"number",maxlength:"11"},null,8,["modelValue"])])),_:1})])),_:1}),h(d,{class:"form-item"},{default:n((()=>[h(d,{class:"input-wrapper"},{default:n((()=>[h(r,{class:"input-icon"},{default:n((()=>[g("ğŸ”")])),_:1}),h(C,{class:"form-input",modelValue:l.phoneForm.code,"onUpdate:modelValue":t[3]||(t[3]=e=>l.phoneForm.code=e),placeholder:"è¯·è¾“å…¥éªŒè¯ç ",type:"number",maxlength:"6"},null,8,["modelValue"]),h(T,{class:"code-btn",disabled:l.countdown>0,onClick:i.sendCode},{default:n((()=>[g(b(l.countdown>0?`${l.countdown}s`:"è·å–éªŒè¯ç "),1)])),_:1},8,["disabled","onClick"])])),_:1})])),_:1})])),_:1})):w("",!0),"account"===l.loginType?(p(),s(d,{key:1,class:"account-login"},{default:n((()=>[h(d,{class:"form-item"},{default:n((()=>[h(d,{class:"input-wrapper"},{default:n((()=>[h(r,{class:"input-icon"},{default:n((()=>[g("ğŸ‘¤")])),_:1}),h(C,{class:"form-input",modelValue:l.accountForm.username,"onUpdate:modelValue":t[4]||(t[4]=e=>l.accountForm.username=e),placeholder:"è¯·è¾“å…¥ç”¨æˆ·å/æ‰‹æœºå·"},null,8,["modelValue"])])),_:1})])),_:1}),h(d,{class:"form-item"},{default:n((()=>[h(d,{class:"input-wrapper"},{default:n((()=>[h(r,{class:"input-icon"},{default:n((()=>[g("ğŸ”’")])),_:1}),h(C,{class:"form-input",modelValue:l.accountForm.password,"onUpdate:modelValue":t[5]||(t[5]=e=>l.accountForm.password=e),placeholder:"è¯·è¾“å…¥å¯†ç ",type:l.showPassword?"text":"password"},null,8,["modelValue","type"]),h(r,{class:"password-toggle",onClick:i.togglePassword},{default:n((()=>[g(b(l.showPassword?"ğŸ‘ï¸":"ğŸ™ˆ"),1)])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})):w("",!0),h(T,{class:"login-btn",disabled:!i.isFormValid,onClick:i.handleLogin},{default:n((()=>[h(r,null,{default:n((()=>[g("ç™»å½•")])),_:1})])),_:1},8,["disabled","onClick"]),h(T,{class:"guest-btn",onClick:i.guestLogin,type:"button"},{default:n((()=>[h(r,null,{default:n((()=>[g("å…æ³¨å†Œä½“éªŒ")])),_:1})])),_:1},8,["onClick"]),h(d,{class:"other-options"},{default:n((()=>[h(d,{class:"forgot-password",onClick:i.forgotPassword},{default:n((()=>[g("å¿˜è®°å¯†ç ï¼Ÿ")])),_:1},8,["onClick"]),h(d,{class:"register-link",onClick:i.goToRegister},{default:n((()=>[g("æ³¨å†Œè´¦å·")])),_:1},8,["onClick"])])),_:1})])),_:1}),h(d,{class:"third-party-login"},{default:n((()=>[h(d,{class:"divider"},{default:n((()=>[h(d,{class:"divider-line"}),h(r,{class:"divider-text"},{default:n((()=>[g("å…¶ä»–ç™»å½•æ–¹å¼")])),_:1}),h(d,{class:"divider-line"})])),_:1}),h(d,{class:"third-party-buttons"},{default:n((()=>[l.isWechatSupported?(p(),s(d,{key:0,class:"third-party-btn wechat-btn",onClick:i.handleWechatLogin},{default:n((()=>[h(d,{class:"btn-icon"},{default:n((()=>[g("ğŸ’¬")])),_:1}),h(d,{class:"btn-text"},{default:n((()=>[g("å¾®ä¿¡ç™»å½•")])),_:1})])),_:1},8,["onClick"])):w("",!0),l.isQQSupported?(p(),s(d,{key:1,class:"third-party-btn qq-btn",onClick:i.handleQQLogin},{default:n((()=>[h(d,{class:"btn-icon"},{default:n((()=>[g("ğŸ§")])),_:1}),h(d,{class:"btn-text"},{default:n((()=>[g("QQç™»å½•")])),_:1})])),_:1},8,["onClick"])):w("",!0),l.isAppleSupported?(p(),s(d,{key:2,class:"third-party-btn apple-btn",onClick:i.handleAppleLogin},{default:n((()=>[h(d,{class:"btn-icon"},{default:n((()=>[g("ğŸ")])),_:1}),h(d,{class:"btn-text"},{default:n((()=>[g("è‹¹æœç™»å½•")])),_:1})])),_:1},8,["onClick"])):w("",!0)])),_:1})])),_:1}),h(d,{class:"agreement"},{default:n((()=>[h(r,{class:"agreement-text"},{default:n((()=>[g(" ç™»å½•å³è¡¨ç¤ºåŒæ„ "),h(r,{class:"agreement-link",onClick:i.viewAgreement},{default:n((()=>[g("ã€Šç”¨æˆ·åè®®ã€‹")])),_:1},8,["onClick"]),g(" å’Œ "),h(r,{class:"agreement-link",onClick:i.viewPrivacy},{default:n((()=>[g("ã€Šéšç§æ”¿ç­–ã€‹")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-e219a0b7"]]);export{A as default};
