import{_ as a,c as e,w as s,a as t,A as n,n as l,i,r as d,o as c,e as o,m as r,k as u,j as m,t as f,q as g,u as h,F as _,v as b,J as y,D as p}from"./js/index.DiTfkHc-.js";import{P as k}from"./PageHeader.Bk91XqsU.js";import{s as C,u as M,g as I,a as w}from"./family.4SulrOfU.js";import"./request.BnSz9hlZ.js";const D=a({components:{PageHeader:k},data:()=>({familyMembers:[],guardianInfo:null,loading:!1}),onLoad(){this.loadData()},methods:{async loadData(){this.loading=!0;try{const a=await I();0===a.code&&(this.familyMembers=a.data);const e=await w();0===e.code&&(this.guardianInfo=e.data)}catch(a){console.error("加载数据失败:",a),t({title:"加载失败",icon:"none"})}finally{this.loading=!1}},addFamilyMember(){l({url:"/pages/family/add"})},editMember(a){l({url:`/pages/family/detail?id=${a.id}`})},viewMemberDetail(a){l({url:`/pages/family/detail?id=${a.id}`})},async deleteMember(a){n({title:"确认删除",content:`确定要删除家庭成员 ${a.name} 吗？`,success:async a=>{if(a.confirm)try{t({title:"删除成功",icon:"success"}),this.loadData()}catch(e){t({title:"删除失败",icon:"none"})}}})},editGuardian(){l({url:"/pages/user/guardian"})},async unbindGuardian(){n({title:"确认解绑",content:"确定要解绑监护人吗？",success:async a=>{if(a.confirm)try{0===(await M(this.guardianInfo.id)).code&&(t({title:"解绑成功",icon:"success"}),this.guardianInfo=null)}catch(e){t({title:"解绑失败",icon:"none"})}}})},async toggleSharing(a){try{0===(await C({memberId:a.id,enabled:!a.sharingEnabled,sharedData:["health","medication","appointment"]})).code&&(a.sharingEnabled=!a.sharingEnabled,t({title:a.sharingEnabled?"已开启共享":"已关闭共享",icon:"success"}))}catch(e){t({title:"设置失败",icon:"none"})}}}},[["render",function(a,t,n,l,k,C){const M=d("page-header"),I=i,w=m,D=g,j=p;return c(),e(I,{class:"container"},{default:s((()=>[o(M,{title:"家庭成员"}),o(I,{class:"content"},{default:s((()=>[k.guardianInfo?(c(),e(I,{key:0,class:"guardian-section"},{default:s((()=>[o(I,{class:"section-title"},{default:s((()=>[u("监护人信息")])),_:1}),o(I,{class:"guardian-card"},{default:s((()=>[o(I,{class:"guardian-info"},{default:s((()=>[o(w,{class:"guardian-name"},{default:s((()=>[u(f(k.guardianInfo.name),1)])),_:1}),o(w,{class:"guardian-relation"},{default:s((()=>[u(f(k.guardianInfo.relationship),1)])),_:1}),o(w,{class:"guardian-phone"},{default:s((()=>[u(f(k.guardianInfo.phoneNumber),1)])),_:1})])),_:1}),o(I,{class:"guardian-actions"},{default:s((()=>[o(D,{class:"action-btn",onClick:C.editGuardian},{default:s((()=>[u("编辑")])),_:1},8,["onClick"]),o(D,{class:"action-btn danger",onClick:C.unbindGuardian},{default:s((()=>[u("解绑")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})):r("",!0),o(I,{class:"family-section"},{default:s((()=>[o(I,{class:"section-header"},{default:s((()=>[o(w,{class:"section-title"},{default:s((()=>[u("家庭成员")])),_:1}),o(D,{class:"add-btn",onClick:C.addFamilyMember},{default:s((()=>[u("添加成员")])),_:1},8,["onClick"])])),_:1}),k.familyMembers.length>0?(c(),e(I,{key:0,class:"family-list"},{default:s((()=>[(c(!0),h(_,null,b(k.familyMembers,((a,t)=>(c(),e(I,{class:"family-item",key:t,onClick:e=>C.viewMemberDetail(a)},{default:s((()=>[o(I,{class:"member-avatar"},{default:s((()=>[o(w,null,{default:s((()=>[u(f(a.name.charAt(0)),1)])),_:2},1024)])),_:2},1024),o(I,{class:"member-info"},{default:s((()=>[o(w,{class:"member-name"},{default:s((()=>[u(f(a.name),1)])),_:2},1024),o(w,{class:"member-relation"},{default:s((()=>[u(f(a.relationship),1)])),_:2},1024)])),_:2},1024),o(I,{class:"member-actions"},{default:s((()=>[o(D,{class:"action-btn small",onClick:y((e=>C.editMember(a)),["stop"])},{default:s((()=>[u("编辑")])),_:2},1032,["onClick"]),o(D,{class:"action-btn small danger",onClick:y((e=>C.deleteMember(a)),["stop"])},{default:s((()=>[u("删除")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})):(c(),e(I,{key:1,class:"empty-state"},{default:s((()=>[o(w,{class:"empty-text"},{default:s((()=>[u("暂无家庭成员，点击添加")])),_:1})])),_:1}))])),_:1}),o(I,{class:"sharing-section"},{default:s((()=>[o(I,{class:"section-title"},{default:s((()=>[u("数据共享设置")])),_:1}),(c(!0),h(_,null,b(k.familyMembers,((a,t)=>(c(),e(I,{class:"sharing-item",key:t},{default:s((()=>[o(I,{class:"sharing-info"},{default:s((()=>[o(w,{class:"member-name"},{default:s((()=>[u(f(a.name),1)])),_:2},1024),o(w,{class:"sharing-status"},{default:s((()=>[u(f(a.sharingEnabled?"已共享":"未共享"),1)])),_:2},1024)])),_:2},1024),o(j,{checked:a.sharingEnabled,onChange:e=>C.toggleSharing(a),color:"#6C63FF"},null,8,["checked","onChange"])])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-6de3ae5c"]]);export{D as default};
